<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Assignment2-COMP2112</title>
    <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <link rel="stylesheet" href="custom.css" />
    
</head>

<body>
    <div class="container col-12">
    <h1 class="col-12">Let's talk. Try to ask me following questions one by one</h1>
    <h3 class="col-4 col-sm-4">Who are you?</h3>
    <h3 class="col-4">How are you?</h3>
    <h3 class="col-4">Who is Raj?</h3>
    <h3 class="col-4">Who is Pankaj?</h3>
    <h3 class="col-4">How many languages can you speak?</h3>
    <h3 class="col-4">Open maps</h3>
    <h3 class="col-4">Locate me (after map is open).</h3>
    <h3 class="col-4">I am mad at you</h3>
    <h3 class="col-4">Bye</h3>
    <div><h5>(Please take a look at console. Are you pronouncing it right?)</h5></div>
    <div><h5>(For better results please use Google Chrome)</h5></div>
    <div id="map" class="col-7">
    <a href='#' id='geolocate'></a>
</div>
</div>

    <script>
        // AJAX
        //using fetch/then.catch
        function getInfo() {
            fetch('data.json')
                .then(res => res.json())
                .then(res => console.log(res))
                .catch(err => console.log(err));
        }
        //using async/await/fetch
        // async function getInfo(){
        //     var response = await fetch('./responses.json');
        //     response = response.json();
        //     console.log(response);
        // }


        // END OF AJAX
        getInfo();


        // embedded map using mapbox        
        function initMap() {
            L.mapbox.accessToken = 'pk.eyJ1Ijoid2Vic29sdXRlLXRlY2giLCJhIjoiY2phd2tpOGRqMG5tcDM3bzEwdW55anE5bSJ9.sPGBdwhnc7uSpIir3JlSRA';
            var geolocate = document.getElementById('geolocate');
            var map = L.mapbox.map('map', 'mapbox.streets');

            var myLayer = L.mapbox.featureLayer().addTo(map);

            if (!navigator.geolocation) {
                geolocate.innerHTML = 'Geolocation is not available';
            } else {
                geolocate.onclick = function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    map.locate();
                };
            }

            // Once we've got a position, zoom and center the map
            // on it, and add a single marker.
            map.on('locationfound', function (e) {
                map.fitBounds(e.bounds);

                myLayer.setGeoJSON({
                    type: 'Feature',
                    geometry: {
                        type: 'Point',
                        coordinates: [e.latlng.lng, e.latlng.lat]
                    },
                    properties: {
                        'title': 'Located!',
                        'marker-color': '#0000ff',
                        'marker-symbol': 'star'
                    }
                });

                // And hide the geolocation button
                geolocate.parentNode.removeChild(geolocate);
            });

            // If the user chooses not to allow their location
            // to be shared, display an error message.
            map.on('locationerror', function () {
                geolocate.innerHTML = 'Position could not be found';
            });
        }
        
        //speech synthesis API to read the text on screen
        var raj = new SpeechSynthesisUtterance();
        var synthesis = speechSynthesis;
        raj.text = document.querySelector('h1').textContent;
        speechSynthesis.lang = "en-US"
        speechSynthesis.speak(raj);

        // voice recognition API to recognize what is said
        window.SpeechRecognition =
            window.SpeechRecognition || window.SpeechRecognition;

        var recognition = new webkitSpeechRecognition();
        recognition.lang = "en-US"
        recognition.addEventListener("end", recognition.start);
        recognition.start(); //start new instance

        recognition.addEventListener("result", event => {
            var whatIsSaid = event.results[0][0].transcript;
            console.log(whatIsSaid);//display in console what is listened by recognition

            //used switch statement to answer the questions
            switch (whatIsSaid) {
                case ("who is Raj"):
                    var sayIt = new SpeechSynthesisUtterance("Raj is the one reason, that I am talking to you.");
                    synthesis.speak(sayIt);
                    break;
                case ("who is pankaj"):
                    var sayIt = new SpeechSynthesisUtterance("He developed my code so i can assist you.");
                    synthesis.speak(sayIt);
                    break;
                case ("how are you"):
                    var sayIt = new SpeechSynthesisUtterance("I am good. How are you doing?");
                    synthesis.speak(sayIt);
                    break;
                case ("who are you"):
                    var sayIt = new SpeechSynthesisUtterance("My name is Mike, and i am your new assistant.");
                    synthesis.speak(sayIt);
                    break;
                case ("how many languages can you speak"):
                    var sayIt = new SpeechSynthesisUtterance("Actually, i don't know yet. I would ask Raj or Pankaj and let you know.");
                    synthesis.speak(sayIt);
                    break;
                case ("I am mad at you"):
                    var sayIt = new SpeechSynthesisUtterance("I am sorry, if I did something wrong.");
                    synthesis.speak(sayIt);
                    break;
                case ("bye"):
                    var sayIt = new SpeechSynthesisUtterance("See ya Later! Have a wonderful day");
                    synthesis.speak(sayIt);
                    break;
                case ("open maps"):
                    initMap();
                    break;
                case ('locate me'):
                    document.getElementById('geolocate').click();
                    break;
            }
            
        });
    </script>
</body>

</html>